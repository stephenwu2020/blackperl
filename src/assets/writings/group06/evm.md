# 虚拟机EVM

处理器是运行一系列计算机指令的集成电路，每个处理器包含一组它自己能够运行的操作。一条指令由操作码和运算数据组成。x86指令集是当今最常用的指令集，含有超过1000个独立的操作码。

程序是一组有序的指令集合，所有的程序，包括打孔机代码，汇编，高级语言如 Python，都被编译和解释成一系列原生字节码。这些字节码对应着能被处理器理解，按顺序运行的指令，下图展示了 Hello World 程序在 x86 架构的汇编集：

![img](/book/assembly.png)

虚拟机，VM，是尝试成为处理器的软件程序。它有自身的操作码，能够运行根据这些操作码编写的指令。这些底层的字节数据，能够被 VM 读取，对应 VM 的指令，通常被称为字节码。编程语言能够编译成字节码，让虚拟机运行。Java 虚拟机，JVM，是当今最流行的虚拟机，支持多种语言的运行，包括 Java，Scala，Groovy，和 Jython。

因为虚拟机是处理器的模拟，它的优势之一，是可以忽略底层的硬件。一旦虚拟机接入了新的平台，如 Windows, Linux, 或者嵌入式系统，能够在虚拟机运行的程序，也就能够在对应的操作系统运行。如 Java 名言，一次编写，处处可运行。

Ethereum 拥有自身的虚拟机，叫做 Ethereum Virtual Machine，EVM。Ethereum 之所以实现自身的虚拟机， 因为它的每个指令都对应 gas 小费。小费一方面防止垃圾攻击，一方面让 EVM 成为无需许可的公共资源。EVM 每个操作码都有自己的小费，意味着，优秀的 contract 运行花费更便宜。例如，SSTORE 操作码，将数据写入状态树，这是一个昂贵的操作，因为写入的数据会复制到网络的所有节点上。

Transaction 字节码的所有指令的 gas 小费的总和，就是 transaction 的小费。
