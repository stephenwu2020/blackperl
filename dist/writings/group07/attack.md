# 攻击

绝对完美的激励机制是不存在的。任何 blockchain 都会存在一系列的攻击手段使得系统暴露。优秀系统的设计目标之一，就是使得破坏系统的这些攻击手段的应用难度更大。让我们看看针对 Ethereum 的主要攻击手段。

### 51%攻击
Ethereum 的挖矿系统，被设计成，只要没有机构拥有超过一半 hashpower，就是安全的。超过系统一半 hashpower 的机构，可以发起51%攻击，从而使得网络失去信任。

网络中可以存在多条链，只有一条成为主链。判断哪一条链是主链的规则非常简单：最长的链就是主链。最安全的链，是消耗了最多 hashpower 的链，而最长的链消耗了最多的 hashpower。另外，决定主链的规则必须简单，各个节点能够轻松达成对主链共识。

51%攻击是这样子的：攻击者挖矿成功，创建了新的 block，然而不广播到网络之中，只存储在本地。由于攻击者有超过一半的 hashpower，本地的链发展得更快，会超过原来的主链。经过一段时间之后，比如说，经过一天，攻击者广播它自己的链，成为网络的主链，期间其他的交易全都作废。

昨天进行交易的商家，只能硬着头皮找卖家拿回商品，或者要求重新付款。反复这个过程，用户就会对 blockchain 失去信任。到目前为止，对于越大的 blockchain，这种攻击越是理论上的，建立超过51%的 hashpower 所需要的资金是海量的，甚至超过了 blockchain 带来的价值。要是说打算弄垮 Bitcoin 或者 Ethereum 这样的大型 blockchain，攻击者必须获得海量的资金需求，同时有很重要的原因，才会去尝试。目前并没有成功的案例，这种尝试可以说是一种赌博。

### 网络垃圾
之前提到，交易小费用于防止恶意破坏者制造毫无意义的垃圾信息。这其实有一点误解了，实质上，交易小费仅仅让制作垃圾者付出代价，使得其他用户的交易小费提高了。

网络垃圾目前在 Ethereum 使用最有效的，竟是用于排查 EVM 的 bug。在2016年9月份，网络上一攻击者瞄准了 EXTCODESIZE 操作码下手，使得 block 的认证时间提升至60秒。EXTCODESIZE 操作码需要读去磁盘，获得 contract 代码的大小。当时这个操作消耗20 gas，攻击者让 block 认证的时候重复执行这个操作超过5000次，从而增加了认证时间，降低了网络运行速度。后来这个问题在 EIP150 上修改为每次消耗 700 gas，而得到解决。

### 破解密码学
也许攻击 blockchain 最有效的方式，是破解当中使用的密码学算法。Ethereum 的 POW 算法，Ethash，使用 Keccak-256 作为哈希算法，使用 Secp256k1 椭圆曲线产生公钥和私钥。破解其中之一，都会巨大地打击用户的信心。幸运的是，这不是说那么简单的。

Ethereum smart contract 大量地使用哈希函数来隐藏信息。Keccak256 不仅仅在 Ethash 上使用，在 EVM 的操作码中也有使用。同时，在地址，transaction, block 哈希信息，ABI里，都有使用。

有很多很简单的方法用于破解哈希函数。最基础的是哈希字典，把最常用的输入输出记录在数据库里，在你使用的时候，在数据库里查询是否有相对应的记录。避免这种破解，得确保输入是随机产生的，不会匹配到常用的记录。

### 回放攻击

回放攻击仅仅出现在 hard fork。Ethereum 和 Ethereum Classic 分裂的过程中，遇到了一个很重要的问题。很多用户的交易原本在 Ethereum 上运行，在 hard fork 之后，这些交易在 Ethereum Classic 上回放。

在 hard fork 期间，用户在不同的分支拥有相同的资金额，就是说，用户在 Ethereum 和 Ethereum Classic 上拥有同样的资金，同时两个网络的运行逻辑都是一样的。

资金账户都是有私钥保护的，任何人想要动用资金，必须用私钥签名。在 hard fork 刚开始，用户在两边账户的私钥是一样的，现在假设有人在 Ethereum 发送了交易信息，攻击者把信息 copy，然后到 Ethereum Classic 上广播，两个信息都是合法的。而其中的受益者，是交易的接收者。
