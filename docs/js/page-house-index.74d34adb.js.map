{"version":3,"sources":["webpack:///./src/scripts/house/drawing/landCoordinate.ts","webpack:///./src/components/house/Scene.vue?853b","webpack:///./src/pages/house/index.vue","webpack:///./src/components/house/Scene.vue?4071","webpack:///./src/components/house/Scene.vue?c1d7","webpack:///./src/pages/house/index.vue?2710","webpack:///./src/pages/house/index.vue?0a18","webpack:///./src/pages/house/index.vue?fd4a","webpack:///./src/scripts/house/drawing/drawUtil.ts","webpack:///./src/pages/house/index.vue?de24","webpack:///./node_modules/core-js/internals/array-fill.js","webpack:///./src/components/house/Scene.vue?021b","webpack:///./src/pages/house/index.vue?04a5","webpack:///./src/components/house/Scene.vue","webpack:///./node_modules/core-js/modules/es.array.fill.js","webpack:///./src/scripts/house/drawing/landRender.ts"],"names":["x","y","this","dragFromX","dragFromY","dragToX","dragToY","dragMoveX","dragMoveY","getPos","dragStart","dragEnd","dragMove","getMoved","directMove","offset","getCanvasMidPos","ctx","canvas","width","height","canvasPos2LandPos","pos","setOriginPos","landPos2GridPos","r","Math","floor","MacroScene","HouseSize","c","gridPos2LandPos","gridMiddle2LandPos","LandCoordinate","extend","components","Scene","data","ok","CanvasWidth","CanvasHeight","canvasElem","created","$app","house","init","checkOK","mounted","$refs","context","getContext","methods","hasInit","render","_vm","_h","$createElement","_c","_self","staticRenderFns","staticClass","ref","attrs","_e","component","drawWrapper","callback","save","translate","beginPath","closePath","restore","rectInCanvas","objPos","objSize","fixedX","fixedY","inView","drawImageMid","midPos","image","imageSize","drawImage","surround","distance","rows","cols","ri","RowNum","ci","ColNum","push","toObject","toAbsoluteIndex","toLength","module","exports","value","O","length","argumentsLength","arguments","index","undefined","end","endPos","props","type","Object","landCoord","land","LandRender","draging","clickFlag","selectedGrid","draw","addEventListener","onMouseDown","onMouseMove","onMouseUp","window","onKeyDown","clear","drawLand","drawSelectedGrid","drawHouse","clearRect","drawUtil","rectPos","fillStyle","rect","fill","houseImage","imageMgr","getImage","size","HouseImageSize","obj","onClick","event","canvasPos","offsetX","offsetY","mapPos","gridPos","startX","clientX","startY","clientY","targetX","targetY","key","$","addToUnscopables","target","proto","lineColor","lineWidth","drawRows","drawCols","strokeStyle","lineY","i","moveTo","lineTo","stroke","lineX"],"mappings":"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","file":"js/page-house-index.74d34adb.js","sourcesContent":["import { MacroScene } from \"@/scripts/house/macro\";\nimport { IPos, IGridPos } from \"@/scripts/house/interfaces\";\n\n/**\n * land 坐标系\n * canvas坐标，指相对于canvas原点的坐标，所有显示的点都是canvas的点\n * land坐标，指相对于全部土地原点的坐标，land在canvas上移动\n * grid坐标，指land上某一块土地，(1,2)表示1行2列的土地的启起点\n */\nexport class LandCoordinate {\n  private x: number;\n  private y: number;\n  private dragFromX: number;\n  private dragFromY: number;\n  private dragToX: number;\n  private dragToY: number;\n  private dragMoveX: number;\n  private dragMoveY: number;\n\n  constructor(x: number, y: number) {\n    this.x = x;\n    this.y = y;\n\n    this.dragFromX = 0;\n    this.dragFromY = 0;\n\n    this.dragToX = 0;\n    this.dragToY = 0;\n\n    this.dragMoveX = 0;\n    this.dragMoveY = 0;\n  }\n\n  getPos(): IPos {\n    return { x: this.x, y: this.y };\n  }\n\n  // dragStart, dragEnd, dragMove 配合使用，实现拖拽效果\n  // 鼠标点击时，dragStart设置起点\n  // 鼠标移动，dragEnd设置目标，调用dragMove移动land\n  dragStart(x: number, y: number) {\n    this.dragFromX = x;\n    this.dragFromY = y;\n  }\n\n  dragEnd(x: number, y: number) {\n    this.dragToX = x;\n    this.dragToY = y;\n  }\n\n  dragMove() {\n    this.dragMoveX = this.dragToX - this.dragFromX;\n    this.dragMoveY = this.dragToY - this.dragFromY;\n    this.x += this.dragMoveX;\n    this.y += this.dragMoveY;\n  }\n\n  getMoved(): IPos {\n    return { x: this.dragMoveX, y: this.dragMoveY };\n  }\n\n  // directMove 直接移动land\n  directMove(offset: IPos) {\n    this.x += offset.x;\n    this.y += offset.y;\n  }\n\n  getCanvasMidPos(ctx: CanvasRenderingContext2D): IPos {\n    return {\n      x: ctx.canvas.width / 2 - this.x,\n      y: ctx.canvas.height / 2 - this.y\n    };\n  }\n\n  canvasPos2LandPos(pos: IPos): IPos {\n    return {\n      x: pos.x - this.x,\n      y: pos.y - this.y\n    };\n  }\n\n  setOriginPos(pos: IPos) {\n    this.x = pos.x;\n    this.y = pos.y;\n  }\n\n  static landPos2GridPos(pos: IPos): IGridPos {\n    const r = Math.floor(pos.y / MacroScene.HouseSize);\n    const c = Math.floor(pos.x / MacroScene.HouseSize);\n    return { r, c };\n  }\n\n  static gridPos2LandPos(r: number, c: number): IPos {\n    const x = c * MacroScene.HouseSize;\n    const y = r * MacroScene.HouseSize;\n    return { x, y };\n  }\n\n  static gridMiddle2LandPos(r: number, c: number): IPos {\n    const x = c * MacroScene.HouseSize + MacroScene.HouseSize / 2;\n    const y = r * MacroScene.HouseSize + MacroScene.HouseSize / 2;\n    return { x, y };\n  }\n}\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=script&lang=ts&\"","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport Vue from \"vue\";\nimport { ICanvasElem } from \"@/scripts/house/interfaces\";\nimport { MacroScene } from \"@/scripts/house/macro\";\nimport Scene from \"@/components/house/Scene.vue\";\n\ninterface IData {\n  ok: boolean;\n  width: number;\n  height: number;\n  canvasElem: ICanvasElem | null;\n}\n\nexport default Vue.extend({\n  components: { Scene },\n  data(): IData {\n    return {\n      ok: false,\n      width: MacroScene.CanvasWidth,\n      height: MacroScene.CanvasHeight,\n      canvasElem: null\n    };\n  },\n\n  async created() {\n    await this.$app.house.init();\n    this.checkOK();\n  },\n\n  mounted() {\n    const canvas = this.$refs.canvas as HTMLCanvasElement;\n    const context = canvas.getContext(\"2d\");\n    if (!context) return;\n\n    this.canvasElem = {\n      width: MacroScene.CanvasWidth,\n      height: MacroScene.CanvasHeight,\n      canvas,\n      context\n    };\n    this.checkOK();\n  },\n\n  methods: {\n    checkOK() {\n      this.ok = this.$app.house.hasInit && this.canvasElem !== null;\n    }\n  }\n});\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div')}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","export * from \"-!../../../node_modules/cache-loader/dist/cjs.js?{\\\"cacheDirectory\\\":\\\"node_modules/.cache/vue-loader\\\",\\\"cacheIdentifier\\\":\\\"80f5dc8c-vue-loader-template\\\"}!../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Scene.vue?vue&type=template&id=af3d9652&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"house\"},[_c('canvas',{ref:\"canvas\",staticClass:\"house-canvas\",attrs:{\"width\":_vm.width,\"height\":_vm.height}}),(_vm.ok)?[_c('scene',{attrs:{\"canvasElem\":_vm.canvasElem}})]:_vm._e()],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","export * from \"-!../../../node_modules/cache-loader/dist/cjs.js?{\\\"cacheDirectory\\\":\\\"node_modules/.cache/vue-loader\\\",\\\"cacheIdentifier\\\":\\\"80f5dc8c-vue-loader-template\\\"}!../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=template&id=7db0c31a&scoped=true&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=7db0c31a&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=ts&\"\nexport * from \"./index.vue?vue&type=script&lang=ts&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=7db0c31a&lang=postcss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"7db0c31a\",\n  null\n  \n)\n\nexport default component.exports","import { MacroScene } from \"@/scripts/house/macro\";\nimport { IPos } from \"@/scripts/house/interfaces\";\n\nexport const drawWrapper = (\n  ctx: CanvasRenderingContext2D,\n  pos: IPos,\n  callback: Function\n) => {\n  ctx.save();\n  ctx.translate(pos.x, pos.y);\n  ctx.beginPath();\n  callback(ctx, pos);\n  ctx.closePath();\n  ctx.restore();\n};\n\nexport const rectInCanvas = (\n  ctx: CanvasRenderingContext2D,\n  objPos: IPos,\n  pos: IPos,\n  objSize: number\n) => {\n  const fixedX = objPos.x + pos.x;\n  const fixedY = objPos.y + pos.y;\n  const inView =\n    fixedX >= -objSize &&\n    fixedX <= ctx.canvas.width &&\n    fixedY >= -objSize &&\n    fixedY <= ctx.canvas.height;\n  return inView;\n};\n\nexport const drawImageMid = (\n  ctx: CanvasRenderingContext2D,\n  midPos: IPos,\n  image: CanvasImageSource,\n  imageSize: number\n) => {\n  ctx.drawImage(\n    image,\n    midPos.x - imageSize / 2,\n    midPos.y - imageSize / 2,\n    imageSize,\n    imageSize\n  );\n};\n\nexport const surround = (r: number, c: number, distance: number) => {\n  const rows = [];\n  const cols = [];\n  for (let ri = r - distance; ri <= r + distance; ri++) {\n    if (ri < 0 || ri >= MacroScene.RowNum) continue;\n    for (let ci = c - distance; ci <= c + distance; ci++) {\n      if (ci < 0 || ci >= MacroScene.ColNum) continue;\n      rows.push(ri);\n      cols.push(ci);\n    }\n  }\n  return { rows, cols };\n};\n","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=7db0c31a&lang=postcss&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=7db0c31a&lang=postcss&scoped=true&\"","'use strict';\nvar toObject = require('../internals/to-object');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar toLength = require('../internals/to-length');\n\n// `Array.prototype.fill` method implementation\n// https://tc39.github.io/ecma262/#sec-array.prototype.fill\nmodule.exports = function fill(value /* , start = 0, end = @length */) {\n  var O = toObject(this);\n  var length = toLength(O.length);\n  var argumentsLength = arguments.length;\n  var index = toAbsoluteIndex(argumentsLength > 1 ? arguments[1] : undefined, length);\n  var end = argumentsLength > 2 ? arguments[2] : undefined;\n  var endPos = end === undefined ? length : toAbsoluteIndex(end, length);\n  while (endPos > index) O[index++] = value;\n  return O;\n};\n","import { render, staticRenderFns } from \"./Scene.vue?vue&type=template&id=af3d9652&\"\nimport script from \"./Scene.vue?vue&type=script&lang=ts&\"\nexport * from \"./Scene.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--14-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=ts&\"","\n\n\n\n\nimport Vue from \"vue\";\nimport { ICanvasElem } from \"@/scripts/house/interfaces\";\nimport { LandCoordinate } from \"@/scripts/house/drawing/landCoordinate\";\nimport * as drawUtil from \"@/scripts/house/drawing/drawUtil\";\nimport { IPos, IGridPos } from \"@/scripts/house/interfaces\";\nimport { MacroScene } from \"@/scripts/house/macro\";\nimport { LandRender } from \"@/scripts/house/drawing/landRender\";\n\ninterface IData {\n  landCoord: LandCoordinate;\n  land: LandRender;\n  draging: boolean;\n  clickFlag: boolean;\n  selectedGrid: IGridPos | null;\n}\n\nexport default Vue.extend({\n  props: { canvasElem: { type: Object as () => ICanvasElem } },\n  data(): IData {\n    return {\n      landCoord: new LandCoordinate(0, 0),\n      land: new LandRender(),\n      draging: false,\n      clickFlag: false,\n      selectedGrid: null\n    };\n  },\n\n  mounted() {\n    this.draw();\n    this.canvasElem.canvas.addEventListener(\"mousedown\", this.onMouseDown);\n    this.canvasElem.canvas.addEventListener(\"mousemove\", this.onMouseMove);\n    this.canvasElem.canvas.addEventListener(\"mouseup\", this.onMouseUp);\n    this.canvasElem.canvas.addEventListener(\"mouseout\", this.onMouseUp);\n    window.addEventListener(\"keydown\", this.onKeyDown);\n  },\n\n  methods: {\n    draw() {\n      this.clear();\n      this.drawLand();\n      this.drawSelectedGrid();\n      this.drawHouse();\n    },\n\n    clear() {\n      this.canvasElem.context.clearRect(\n        0,\n        0,\n        this.canvasElem.width,\n        this.canvasElem.height\n      );\n    },\n\n    drawLand() {\n      const pos = this.landCoord.getPos();\n      const callback = (ctx: CanvasRenderingContext2D, pos: IPos) => {\n        this.land.draw(ctx, pos);\n      };\n      drawUtil.drawWrapper(this.canvasElem.context, pos, callback);\n    },\n\n    drawSelectedGrid() {\n      if (!this.selectedGrid) return;\n\n      const callback = (ctx: CanvasRenderingContext2D, pos: IPos) => {\n        if (!this.selectedGrid) return;\n        const rectPos = {\n          x: this.selectedGrid.c * MacroScene.HouseSize,\n          y: this.selectedGrid.r * MacroScene.HouseSize\n        };\n        ctx.fillStyle = \"rgba(188,213,103, 0.5)\";\n        ctx.rect(\n          rectPos.x,\n          rectPos.y,\n          MacroScene.HouseSize,\n          MacroScene.HouseSize\n        );\n        ctx.fill();\n      };\n\n      const pos = this.landCoord.getPos();\n      drawUtil.drawWrapper(this.canvasElem.context, pos, callback);\n    },\n\n    drawHouse() {\n      const callback = (ctx: CanvasRenderingContext2D, pos: IPos) => {\n        const midPos = LandCoordinate.gridMiddle2LandPos(0, 0);\n        const houseImage = this.$app.house.imageMgr.getImage(\"house1.png\");\n        const size = MacroScene.HouseImageSize;\n        drawUtil.drawImageMid(\n          this.canvasElem.context,\n          midPos,\n          houseImage.obj,\n          size\n        );\n      };\n      const pos = this.landCoord.getPos();\n      drawUtil.drawWrapper(this.canvasElem.context, pos, callback);\n    },\n\n    onClick(event: any) {\n      const canvasPos = { x: event.offsetX, y: event.offsetY };\n      const mapPos = this.landCoord.canvasPos2LandPos(canvasPos);\n      const gridPos = LandCoordinate.landPos2GridPos(mapPos);\n      if (\n        gridPos.r < 0 ||\n        gridPos.r >= MacroScene.RowNum ||\n        gridPos.c < 0 ||\n        gridPos.c >= MacroScene.ColNum\n      )\n        this.selectedGrid = null;\n      else this.selectedGrid = gridPos;\n      this.draw();\n    },\n\n    onMouseDown(event: any) {\n      const startX = event.clientX;\n      const startY = event.clientY;\n      this.draging = true;\n      this.clickFlag = true;\n      this.landCoord.dragStart(startX, startY);\n    },\n\n    onMouseUp(event: any) {\n      this.draging = false;\n      if (this.clickFlag) this.onClick(event);\n    },\n\n    onMouseMove(event: any) {\n      this.clickFlag = false;\n      if (!this.draging) return;\n\n      const targetX = event.clientX;\n      const targetY = event.clientY;\n      this.landCoord.dragEnd(targetX, targetY);\n      this.landCoord.dragMove();\n\n      this.draw();\n      this.landCoord.dragStart(targetX, targetY);\n    },\n\n    onKeyDown(event: any) {\n      const offset = 10;\n      switch (event.key) {\n        case \"d\":\n          this.landCoord.directMove({ x: offset, y: 0 });\n          this.draw();\n          break;\n        case \"a\":\n          this.landCoord.directMove({ x: -offset, y: 0 });\n          this.draw();\n          break;\n        case \"w\":\n          this.landCoord.directMove({ x: 0, y: -offset });\n          this.draw();\n          break;\n        case \"s\":\n          this.landCoord.directMove({ x: 0, y: offset });\n          this.draw();\n          break;\n      }\n    }\n  }\n});\n","var $ = require('../internals/export');\nvar fill = require('../internals/array-fill');\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\n// `Array.prototype.fill` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.fill\n$({ target: 'Array', proto: true }, {\n  fill: fill\n});\n\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('fill');\n","import { MacroScene } from \"@/scripts/house/macro\";\nimport { IPos } from \"@/scripts/house/interfaces\";\n\nexport class LandRender {\n  private lineColor: string;\n  private lineWidth: number;\n\n  constructor() {\n    this.lineColor = \"black\";\n    this.lineWidth = 0.1;\n  }\n\n  draw(ctx: CanvasRenderingContext2D, pos: IPos) {\n    this.drawRows(ctx, pos);\n    this.drawCols(ctx, pos);\n  }\n\n  drawRows(ctx: CanvasRenderingContext2D, pos: IPos) {\n    ctx.strokeStyle = this.lineColor;\n    ctx.lineWidth = this.lineWidth;\n    let lineY = 0;\n    let fixedY = 0;\n    ctx.lineWidth = this.lineWidth;\n    for (let i = 0; i <= MacroScene.ColNum; i++) {\n      lineY = i * MacroScene.HouseSize;\n      fixedY = lineY + pos.y;\n      if (fixedY >= 0 && fixedY <= ctx.canvas.height) {\n        ctx.moveTo(0, lineY);\n        ctx.lineTo(MacroScene.RowNum * MacroScene.HouseSize, lineY);\n      }\n    }\n    ctx.stroke();\n  }\n\n  drawCols(ctx: CanvasRenderingContext2D, pos: IPos) {\n    ctx.strokeStyle = this.lineColor;\n    ctx.lineWidth = this.lineWidth;\n    let lineX = 0;\n    let fixedX = 0;\n    for (let i = 0; i <= MacroScene.RowNum; i++) {\n      lineX = i * MacroScene.HouseSize;\n      fixedX = lineX + pos.x;\n      if (fixedX >= 0 && fixedX <= ctx.canvas.width) {\n        ctx.moveTo(lineX, 0);\n        ctx.lineTo(lineX, MacroScene.ColNum * MacroScene.HouseSize);\n      }\n    }\n    ctx.stroke();\n  }\n}\n"],"sourceRoot":""}