(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["page-chat-index"],{"0040":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e,n,a,s,i){this.chatID=t,this.sender=e,this.pubKey=n,this.content=a,this.timestamp=s,this.head=i}return t}();e.Message=a},"01cb":function(t,e,n){"use strict";n.r(e);var a=n("fdc4"),s=n.n(a);for(var i in a)"default"!==i&&function(t){n.d(e,t,(function(){return a[t]}))}(i);e["default"]=s.a},"0db7":function(t,e,n){"use strict";n.r(e);var a=n("6177"),s=n.n(a);for(var i in a)"default"!==i&&function(t){n.d(e,t,(function(){return a[t]}))}(i);e["default"]=s.a},"232f":function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.chatting?n("div",{staticClass:"chat"},[n("div",{staticClass:"chat-top"},[t._v(t._s(t.chatting.name))]),n("div",{ref:"main",staticClass:"chat-main"},t._l(t.chats,(function(t,e){return n("div",{key:e,staticClass:"chat-main-item"},[n("MessageComp",{attrs:{msg:t}}),n("span",{ref:"tail",refInFor:!0,attrs:{id:"chat-main__tail"}})],1)})),0),n("div",{staticClass:"chat-input"},[n("el-input",{staticClass:"chat-input__area",attrs:{type:"textarea"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.ctrlKey||e.shiftKey||e.altKey||e.metaKey?null:t.handleEnter(e)}},model:{value:t.msg,callback:function(e){t.msg=e},expression:"msg"}})],1)]):n("div",{staticClass:"empty"})},s=[];n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return s}))},"263d":function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"msg",class:{me:t.isMe}},[n("div",{staticClass:"msg-head"},[n("img",{staticClass:"msg-head__img",attrs:{src:t.msg.head,alt:""}})]),n("div",{staticClass:"msg-main"},[n("span",{staticClass:"msg-main__name"},[t._v(t._s(t.msg.sender))]),n("div",{staticClass:"msg-main__content"},[t._v(t._s(t.msg.content))])])])},s=[];n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return s}))},2664:function(t,e,n){"use strict";var a=n("6675"),s=n.n(a);s.a},"2e43":function(t,e,n){"use strict";var a=n("6349"),s=n.n(a);s.a},"498a":function(t,e,n){"use strict";var a=n("23e7"),s=n("58a8").trim,i=n("e070");a({target:"String",proto:!0,forced:i("trim")},{trim:function(){return s(this)}})},"4b07":function(t,e,n){},"552c":function(t,e,n){"use strict";n("b0c0"),Object.defineProperty(e,"__esModule",{value:!0});var a=n("9ab4"),s=a.__importDefault(n("2b0e")),i=n("b679");e.default=s.default.extend({data:function(){return{userInput:{name:"",pubKey:""},visible:!1}},computed:{pass:function(){return""!==this.userInput.name&&""!==this.userInput.pubKey}},methods:{show:function(){this.visible=!0},hide:function(){this.reset(),this.visible=!1},reset:function(){var t=this.$refs.form;t.resetFields()},sure:function(){if(this.userInput.name.length>6)this.$message({message:"名字太长了啊(6个字符)!",type:"warning"});else{var t=new i.Private(this.userInput.pubKey,this.userInput.name,this.userInput.pubKey);this.$store.commit("chat/addPrivate",t),this.hide()}}}})},5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,n){var a=n("1d80"),s=n("5899"),i="["+s+"]",r=RegExp("^"+i+i+"*"),u=RegExp(i+i+"*$"),c=function(t){return function(e){var n=String(a(e));return 1&t&&(n=n.replace(r,"")),2&t&&(n=n.replace(u,"")),n}};t.exports={start:c(1),end:c(2),trim:c(3)}},6177:function(t,e,n){"use strict";n("b0c0"),n("498a"),Object.defineProperty(e,"__esModule",{value:!0});var a=n("9ab4"),s=a.__importDefault(n("2b0e")),i=n("2f62"),r=a.__importDefault(n("dba3")),u=n("4875"),c=n("b679"),o=n("0040");e.default=s.default.extend({components:{MessageComp:r.default},data:function(){return{msg:""}},computed:a.__assign({},i.mapState({chatting:function(t){return t.chat.chatting},me:function(t){return t.chat.user}}),{chats:function(){if(!this.chatting)return[];var t=this.$store.state.chat.chatLogs.get(this.chatting.id);return t}}),watch:{chats:function(){var t=this;this.$nextTick((function(){t.scrollBottom()}))}},methods:{handleEnter:function(){return a.__awaiter(this,void 0,void 0,(function(){var t,e,n=this;return a.__generator(this,(function(a){switch(a.label){case 0:return this.msg?(t=this.msg.trim(),t?this.chatting instanceof u.Group?(e=new o.Message(this.chatting.id,this.me.name,this.me.pubKey,t,Date.now(),this.me.head),[4,this.$shh.send(this.chatting.topic,e)]):[3,2]:[2]):[2];case 1:return a.sent(),[3,4];case 2:return this.chatting instanceof c.Private?(e=new o.Message("",this.me.name,this.me.pubKey,t,Date.now(),this.me.head),[4,this.$shh.sendPriv(this.chatting.pubKey,e)]):[3,4];case 3:a.sent(),e.chatID=this.chatting.pubKey,this.$store.commit("chat/pushMessage",e),a.label=4;case 4:return setTimeout((function(){n.msg=""}),100),[2]}}))}))},scrollBottom:function(){var t=this.$refs.main;t.scrollTop=t.scrollHeight}}})},6349:function(t,e,n){},6675:function(t,e,n){},"74b7":function(t,e,n){"use strict";var a=n("4b07"),s=n.n(a);s.a},"75e0":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("9ab4"),s=a.__importDefault(n("2b0e")),i=n("2f62");e.default=s.default.extend({props:["msg"],computed:a.__assign({},i.mapState({me:function(t){return t.chat.user}}),{isMe:function(){var t=this.me.pubKey===this.msg.pubKey;return t}})})},"7a99":function(t,e,n){"use strict";var a=n("8592"),s=n.n(a);s.a},8592:function(t,e,n){},"8c06":function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},[n("div",{staticClass:"home-cont"},[n("Contact")],1),n("div",{staticClass:"home-chat"},[t.chatting?n("Chat"):t._e()],1),t.me?n("div",{staticClass:"home-me"},[n("span",[t._v(t._s(t.me.name))]),n("span",{staticClass:"home-me__pub"},[t._v(t._s(t.me.pubKey))]),n("span",{staticClass:"home-me__copy",on:{click:t.copy}},[t._v("复制")])]):t._e()])},s=[];n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return s}))},"990f":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("9ab4"),s=a.__importDefault(n("2b0e")),i=n("2f62"),r=a.__importDefault(n("9e8e")),u=n("b679");e.default=s.default.extend({components:{AddFriend:r.default},data:function(){return{collapse:""}},computed:a.__assign({},i.mapState({chatting:function(t){return t.chat.chatting},groups:function(t){return t.chat.groups},privates:function(t){return t.chat.privates}})),mounted:function(){this.chatting instanceof u.Private?this.collapse="private":this.collapse="group"},methods:{select:function(t){this.$store.commit("chat/setChatting",t)},addPriv:function(){var t=this.$refs.addFriend;t.show()}}})},"9e8e":function(t,e,n){"use strict";n.r(e);var a=n("de7d"),s=n("d4ce");for(var i in s)"default"!==i&&function(t){n.d(e,t,(function(){return s[t]}))}(i);var r=n("2877"),u=Object(r["a"])(s["default"],a["a"],a["b"],!1,null,null,null);e["default"]=u.exports},a8c2:function(t,e,n){"use strict";n.r(e);var a=n("232f"),s=n("0db7");for(var i in s)"default"!==i&&function(t){n.d(e,t,(function(){return s[t]}))}(i);n("2664");var r=n("2877"),u=Object(r["a"])(s["default"],a["a"],a["b"],!1,null,"53ea588d",null);e["default"]=u.exports},b03c:function(t,e,n){"use strict";n.r(e);var a=n("8c06"),s=n("01cb");for(var i in s)"default"!==i&&function(t){n.d(e,t,(function(){return s[t]}))}(i);n("74b7");var r=n("2877"),u=Object(r["a"])(s["default"],a["a"],a["b"],!1,null,"44fdaec4",null);e["default"]=u.exports},c236:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"cont"},[n("el-collapse",{model:{value:t.collapse,callback:function(e){t.collapse=e},expression:"collapse"}},[n("el-collapse-item",{attrs:{title:"",name:"group"}},[n("div",{staticClass:"cont-title",attrs:{slot:"title"},slot:"title"},[n("i",{staticClass:"fas fa-users"}),n("span",[t._v("群聊")])]),t._l(t.groups,(function(e,a){return n("div",{key:a,staticClass:"cont-item",class:{select:t.chatting.id===e.id},on:{click:function(n){return t.select(e)}}},[t._v(" "+t._s(e.name)+" ")])}))],2),n("el-collapse-item",{attrs:{title:"私聊",name:"private"}},[n("div",{staticClass:"cont-title",attrs:{slot:"title"},slot:"title"},[n("i",{staticClass:"fas fa-user"}),n("span",[t._v("私聊")])]),n("i",{staticClass:"cont-add fas fa-plus",on:{click:t.addPriv}}),t._l(t.privates,(function(e,a){return n("div",{key:a,staticClass:"cont-item",class:{select:t.chatting.id===e.id},on:{click:function(n){return t.select(e)}}},[t._v(" "+t._s(e.name)+" ")])}))],2)],1),n("AddFriend",{ref:"addFriend"})],1)},s=[];n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return s}))},ccb8:function(t,e,n){"use strict";n.r(e);var a=n("990f"),s=n.n(a);for(var i in a)"default"!==i&&function(t){n.d(e,t,(function(){return a[t]}))}(i);e["default"]=s.a},d4ce:function(t,e,n){"use strict";n.r(e);var a=n("552c"),s=n.n(a);for(var i in a)"default"!==i&&function(t){n.d(e,t,(function(){return a[t]}))}(i);e["default"]=s.a},d5fe:function(t,e,n){"use strict";n.r(e);var a=n("75e0"),s=n.n(a);for(var i in a)"default"!==i&&function(t){n.d(e,t,(function(){return a[t]}))}(i);e["default"]=s.a},dba3:function(t,e,n){"use strict";n.r(e);var a=n("263d"),s=n("d5fe");for(var i in s)"default"!==i&&function(t){n.d(e,t,(function(){return s[t]}))}(i);n("7a99");var r=n("2877"),u=Object(r["a"])(s["default"],a["a"],a["b"],!1,null,"1e07c3c1",null);e["default"]=u.exports},dbf5:function(t,e,n){"use strict";n.r(e);var a=n("c236"),s=n("ccb8");for(var i in s)"default"!==i&&function(t){n.d(e,t,(function(){return s[t]}))}(i);n("2e43");var r=n("2877"),u=Object(r["a"])(s["default"],a["a"],a["b"],!1,null,"9f6356d2",null);e["default"]=u.exports},de7d:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dialog",{staticClass:"af",attrs:{"append-to-body":!0,visible:t.visible,width:"400px"},on:{"update:visible":function(e){t.visible=e}}},[n("div",{staticClass:"af-title",attrs:{slot:"title"},slot:"title"},[t._v("添加联系人")]),n("el-form",{ref:"form",attrs:{model:t.userInput}},[n("el-form-item",{attrs:{prop:"name",label:"昵称",placeholder:"请输入昵称"}},[n("el-input",{model:{value:t.userInput.name,callback:function(e){t.$set(t.userInput,"name",e)},expression:"userInput.name"}})],1),n("el-form-item",{attrs:{prop:"pubKey",label:"Public Key",placeholder:"请输入联系人的 publick key"}},[n("el-input",{model:{value:t.userInput.pubKey,callback:function(e){t.$set(t.userInput,"pubKey",e)},expression:"userInput.pubKey"}})],1)],1),n("div",{staticClass:"af-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:t.hide}},[t._v("取消")]),n("el-button",{attrs:{type:"primary",disabled:!t.pass},on:{click:t.sure}},[t._v("确定")])],1)],1)},s=[];n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return s}))},e070:function(t,e,n){var a=n("d039"),s=n("5899"),i="​᠎";t.exports=function(t){return a((function(){return!!s[t]()||i[t]()!=i||s[t].name!==t}))}},fdc4:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("9ab4"),s=a.__importDefault(n("2b0e")),i=n("2f62"),r=a.__importDefault(n("dbf5")),u=a.__importDefault(n("a8c2"));e.default=s.default.extend({components:{Contact:r.default,Chat:u.default},computed:a.__assign({},i.mapState({chatting:function(t){return t.chat.chatting},me:function(t){return t.chat.user}})),created:function(){return a.__awaiter(this,void 0,void 0,(function(){return a.__generator(this,(function(t){switch(t.label){case 0:return[4,this.$app.chat.init()];case 1:return t.sent(),[2]}}))}))},methods:{copy:function(){var t=this;this.$copyText(this.me.pubKey).then((function(){t.$message({message:"Publick Key 已复制到剪贴板",type:"success"})}))}}})}}]);
//# sourceMappingURL=page-chat-index.0e0b7918.js.map